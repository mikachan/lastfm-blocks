(()=>{"use strict";var e,t={721:()=>{const e=window.wp.blocks,t=window.wp.i18n,a=window.wp.blockEditor,l=window.wp.components,r=window.wp.element,n=window.wp.data,s=window.wp.notices,o=window.ReactJSXRuntime;function c({tracks:e,includeLinkToTrack:a,showTrackArtwork:l,imageStyle:r,textAlign:n}){const s=e?.length>0,c=({children:e,url:t})=>a?(0,o.jsx)("a",{href:t,target:"_blank",rel:"noreferrer",className:"track-name",children:e}):(0,o.jsx)("span",{className:"track-name",children:e});return(0,o.jsxs)("ul",{className:`tracks-list has-text-align-${n}`,children:[!s&&(0,o.jsx)("li",{className:"no-tracks-found",children:(0,t.__)("No tracks found.","lastfm-recently-played-block")}),s&&e.map((e=>(0,o.jsxs)("li",{children:[l&&(0,o.jsx)("div",{className:`track-image ${r}`,children:(0,o.jsx)(c,{url:e.url,children:(0,o.jsx)("span",{className:"artwork",role:"img","aria-label":`${e.artist["#text"]} - ${e.name}`,style:{backgroundImage:`url(${e.image[1]["#text"]})`},children:"default"!==r&&(0,o.jsx)("span",{className:"format"})})})}),(0,o.jsxs)("div",{className:"track-info",children:[(0,o.jsx)(c,{url:e.url,children:e.name}),(0,o.jsx)("br",{}),(0,o.jsx)("span",{className:"artist-name",children:e.artist["#text"]})]})]},e.url)))]})}const i=JSON.parse('{"UU":"lastfm-recently-played-block/lastfm-recently-played-block"}');(0,e.registerBlockType)(i.UU,{edit:function({attributes:e,setAttributes:i}){const{apiKey:d,username:m,numberOfTracks:k,showTrackArtwork:u,imageStyle:f,includeLinkToTrack:p,textAlign:x}=e,y=(0,a.useBlockEditingMode)(),[h,_]=(0,r.useState)(!1),[b,g]=(0,r.useState)([]),{createErrorNotice:w,removeNotice:j}=(0,n.useDispatch)(s.store);return(0,r.useEffect)((()=>{d&&m||w((0,t.__)("Please provide a valid Last.fm API key and username.","lastfm-recently-played-block"),{id:"lastfm-recently-played-error"}),d&&m&&(_(!0),async function(e,a,l="1"){return fetch(`https://ws.audioscrobbler.com/2.0/?method=user.getrecenttracks&user=${a}&api_key=${e}&format=json&limit=${l}`).then((e=>e.json())).then((e=>{if(e.error)throw e.message;if("0"===e.recenttracks["@attr"]?.total)throw(0,t.sprintf)(
// translators: %s: Last.fm username
// translators: %s: Last.fm username
(0,t.__)('No Last.fm tracks found from user "%s".',"lastfm-recently-played-block"),a);if(e.recenttracks.track){let t=e.recenttracks.track;return e.recenttracks.track.length===parseInt(l)+1&&(t=e.recenttracks.track.slice(0,l)),t}return[]})).catch((e=>{throw e}))}(d,m,k).then((e=>{g(e),j("lastfm-recently-played-error")})).catch((e=>{g([]),w(e,{id:"lastfm-recently-played-error"})})).finally((()=>{_(!1)})))}),[d,w,k,j,i,_,m]),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(a.InspectorControls,{children:[(0,o.jsxs)(l.PanelBody,{title:(0,t.__)("Display","lastfm-recently-played-block"),children:[(0,o.jsx)(l.ToggleControl,{__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0,label:(0,t.__)("Include links to tracks","lastfm-recently-played-block"),checked:p,onChange:()=>i({includeLinkToTrack:!p})}),(0,o.jsx)(l.__experimentalNumberControl,{__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0,min:1,max:50,label:(0,t.__)("Number of Tracks","lastfm-recently-played-block"),value:k||1,onChange:e=>i({numberOfTracks:e})}),(0,o.jsx)(l.ToggleControl,{__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0,label:(0,t.__)("Show track artwork","lastfm-recently-played-block"),checked:u,onChange:()=>i({showTrackArtwork:!u})}),u&&(0,o.jsx)(l.SelectControl,{__next40pxDefaultSize:!0,label:(0,t.__)("Image Style","lastfm-recently-played-block"),value:f||"default",options:[{label:"Default",value:"default"},{label:"Vinyl",value:"vinyl"},{label:"Cassette",value:"cassette"},{label:"CD",value:"cd"}],onChange:e=>i({imageStyle:e})})]}),(0,o.jsxs)(l.PanelBody,{title:(0,t.__)("Last.fm User Details","lastfm-recently-played-block"),children:[(0,o.jsx)(l.TextControl,{__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0,label:(0,t.__)("Last.fm Username","lastfm-recently-played-block"),value:m||"",onChange:e=>i({username:e})}),(0,o.jsx)(l.TextControl,{__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0,label:(0,t.__)("Last.fm API Key","lastfm-recently-played-block"),help:(0,t.__)("Create a last.fm API key at last.fm/api.","lastfm-recently-played-block"),value:d||"",onChange:e=>i({apiKey:e})})]})]}),(0,o.jsxs)("div",{...(0,a.useBlockProps)(),children:[h&&(0,o.jsx)(l.Spinner,{}),!h&&d&&m&&(0,o.jsxs)(o.Fragment,{children:["default"===y&&(0,o.jsx)(a.BlockControls,{group:"block",children:(0,o.jsx)(a.AlignmentControl,{value:x,onChange:e=>{i({textAlign:e})}})}),(0,o.jsx)(c,{tracks:b,showTrackArtwork:u,imageStyle:f,includeLinkToTrack:p,textAlign:x})]})]})]})}})}},a={};function l(e){var r=a[e];if(void 0!==r)return r.exports;var n=a[e]={exports:{}};return t[e](n,n.exports,l),n.exports}l.m=t,e=[],l.O=(t,a,r,n)=>{if(!a){var s=1/0;for(d=0;d<e.length;d++){a=e[d][0],r=e[d][1],n=e[d][2];for(var o=!0,c=0;c<a.length;c++)(!1&n||s>=n)&&Object.keys(l.O).every((e=>l.O[e](a[c])))?a.splice(c--,1):(o=!1,n<s&&(s=n));if(o){e.splice(d--,1);var i=r();void 0!==i&&(t=i)}}return t}n=n||0;for(var d=e.length;d>0&&e[d-1][2]>n;d--)e[d]=e[d-1];e[d]=[a,r,n]},l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={57:0,350:0};l.O.j=t=>0===e[t];var t=(t,a)=>{var r,n,s=a[0],o=a[1],c=a[2],i=0;if(s.some((t=>0!==e[t]))){for(r in o)l.o(o,r)&&(l.m[r]=o[r]);if(c)var d=c(l)}for(t&&t(a);i<s.length;i++)n=s[i],l.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return l.O(d)},a=self.webpackChunklastfm_recently_played_block=self.webpackChunklastfm_recently_played_block||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))})();var r=l.O(void 0,[350],(()=>l(721)));r=l.O(r)})();