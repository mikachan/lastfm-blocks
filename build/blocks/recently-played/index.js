(()=>{"use strict";var e,t={577:()=>{const e=window.wp.blocks,t=window.wp.i18n,a=window.wp.blockEditor,r=window.wp.components,s=window.wp.element,l=window.wp.data,n=window.wp.notices,o=window.ReactJSXRuntime;function c({tracks:e,includeLinkToTrack:a,showTrackArtwork:r,imageStyle:s,textAlign:l}){const n=e?.length>0,c=({children:e,url:t})=>a?(0,o.jsx)("a",{href:t,target:"_blank",rel:"noreferrer",className:"track-name",children:e}):(0,o.jsx)("span",{className:"track-name",children:e});return(0,o.jsxs)("ul",{className:`tracks-list has-text-align-${l}`,children:[!n&&(0,o.jsx)("li",{className:"no-tracks-found",children:(0,t.__)("No tracks found.","lastfm-blocks")}),n&&e.map((e=>(0,o.jsxs)("li",{children:[r&&(0,o.jsx)("div",{className:`track-image ${s}`,children:(0,o.jsx)(c,{url:e.url,children:(0,o.jsx)("span",{className:"artwork",role:"img","aria-label":`${e.artist["#text"]} - ${e.name}`,style:{backgroundImage:`url(${e.image[1]["#text"]})`},children:"default"!==s&&(0,o.jsx)("span",{className:"format"})})})}),(0,o.jsxs)("div",{className:"track-info",children:[(0,o.jsx)(c,{url:e.url,children:e.name}),(0,o.jsx)("br",{}),(0,o.jsx)("span",{className:"artist-name",children:e.artist["#text"]})]})]},e.url)))]})}const i=JSON.parse('{"UU":"lastfm-blocks/lastfm-recently-played-block"}');(0,e.registerBlockType)(i.UU,{edit:function({attributes:e,setAttributes:i}){const{apiKey:m,username:u,numberOfTracks:k,showTrackArtwork:f,imageStyle:d,includeLinkToTrack:x,textAlign:h}=e,p=(0,a.useBlockEditingMode)(),[_,b]=(0,s.useState)(!1),[w,g]=(0,s.useState)([]),{createErrorNotice:j,removeNotice:v}=(0,l.useDispatch)(n.store);return(0,s.useEffect)((()=>{m&&u||j((0,t.__)("Please provide a valid Last.fm API key and username.","lastfm-blocks"),{id:"lastfm-recently-played-error"}),m&&u&&(b(!0),async function(e,a,r="1"){if(!e||!a)throw new Error("API key and username are required");const s=parseInt(r,10);if(isNaN(s)||s<1)throw new Error("Number of tracks must be a positive number");try{const r=await fetch(`https://ws.audioscrobbler.com/2.0/?method=user.getrecenttracks&user=${a}&api_key=${e}&format=json&limit=${s}`),l=await r.json();if(l.error)throw new Error(l.message);if("0"===l.recenttracks["@attr"]?.total)throw new Error((0,t.sprintf)(
// translators: %s: Last.fm username
// translators: %s: Last.fm username
(0,t.__)('No Last.fm tracks found from user "%s".',"lastfm-blocks"),a));return l.recenttracks.track?l.recenttracks.track.slice(0,s):[]}catch(e){throw e}}(m,u,k).then((e=>{g(e),v("lastfm-recently-played-error")})).catch((e=>{g([]),j(e,{id:"lastfm-recently-played-error"})})).finally((()=>{b(!1)})))}),[m,j,k,v,i,b,u]),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(a.InspectorControls,{children:[(0,o.jsxs)(r.PanelBody,{title:(0,t.__)("Display","lastfm-blocks"),children:[(0,o.jsx)(r.ToggleControl,{__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0,label:(0,t.__)("Include links to tracks","lastfm-blocks"),checked:x,onChange:()=>i({includeLinkToTrack:!x})}),(0,o.jsx)(r.__experimentalNumberControl,{__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0,min:1,max:50,label:(0,t.__)("Number of Tracks","lastfm-blocks"),value:k||1,onChange:e=>i({numberOfTracks:e})}),(0,o.jsx)(r.ToggleControl,{__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0,label:(0,t.__)("Show track artwork","lastfm-blocks"),checked:f,onChange:()=>i({showTrackArtwork:!f})}),f&&(0,o.jsx)(r.SelectControl,{__next40pxDefaultSize:!0,label:(0,t.__)("Image Style","lastfm-blocks"),value:d||"default",options:[{label:"Default",value:"default"},{label:"Vinyl",value:"vinyl"},{label:"Cassette",value:"cassette"},{label:"CD",value:"cd"}],onChange:e=>i({imageStyle:e})})]}),(0,o.jsxs)(r.PanelBody,{title:(0,t.__)("Last.fm User Details","lastfm-blocks"),children:[(0,o.jsx)(r.TextControl,{__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0,label:(0,t.__)("Last.fm Username","lastfm-blocks"),value:u||"",onChange:e=>i({username:e})}),(0,o.jsx)(r.TextControl,{__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0,label:(0,t.__)("Last.fm API Key","lastfm-blocks"),help:(0,t.__)("Create a last.fm API key at last.fm/api.","lastfm-blocks"),value:m||"",onChange:e=>i({apiKey:e})})]})]}),(0,o.jsxs)("div",{...(0,a.useBlockProps)(),children:[_&&(0,o.jsx)(r.Spinner,{}),!_&&m&&u&&(0,o.jsxs)(o.Fragment,{children:["default"===p&&(0,o.jsx)(a.BlockControls,{group:"block",children:(0,o.jsx)(a.AlignmentControl,{value:h,onChange:e=>{i({textAlign:e})}})}),(0,o.jsx)(c,{tracks:w,showTrackArtwork:f,imageStyle:d,includeLinkToTrack:x,textAlign:h})]})]})]})},save:()=>null})}},a={};function r(e){var s=a[e];if(void 0!==s)return s.exports;var l=a[e]={exports:{}};return t[e](l,l.exports,r),l.exports}r.m=t,e=[],r.O=(t,a,s,l)=>{if(!a){var n=1/0;for(m=0;m<e.length;m++){a=e[m][0],s=e[m][1],l=e[m][2];for(var o=!0,c=0;c<a.length;c++)(!1&l||n>=l)&&Object.keys(r.O).every((e=>r.O[e](a[c])))?a.splice(c--,1):(o=!1,l<n&&(n=l));if(o){e.splice(m--,1);var i=s();void 0!==i&&(t=i)}}return t}l=l||0;for(var m=e.length;m>0&&e[m-1][2]>l;m--)e[m]=e[m-1];e[m]=[a,s,l]},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={253:0,841:0};r.O.j=t=>0===e[t];var t=(t,a)=>{var s,l,n=a[0],o=a[1],c=a[2],i=0;if(n.some((t=>0!==e[t]))){for(s in o)r.o(o,s)&&(r.m[s]=o[s]);if(c)var m=c(r)}for(t&&t(a);i<n.length;i++)l=n[i],r.o(e,l)&&e[l]&&e[l][0](),e[l]=0;return r.O(m)},a=self.webpackChunklastfm_blocks=self.webpackChunklastfm_blocks||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))})();var s=r.O(void 0,[841],(()=>r(577)));s=r.O(s)})();